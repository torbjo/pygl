PYTHON=python3
GLHEADER_URL=https://www.opengl.org/registry/oldspecs/glcorearb.h
#GLHEADER_URL=https://www.opengl.org/registry/api/GL/glcorearb.h
#https://www.khronos.org/registry/gles/api/old/3.0/gl3.h

GLHEADER=$(shell basename $(GLHEADER_URL))

# @todo build both gl3 & gl4 bindings

api.py: glcorearb.h api.py.head api.py.tail
	@echo "# Do not edit this file!" > $@
	@echo "# It was auto-generated on $$(date --utc +%FT%TZ) from:" >> $@
	@echo "# $(GLHEADER_URL)" >> $@
	@echo >> $@
	cat api.py.head >> $@
	$(PYTHON) main.py < $(GLHEADER) >> $@
	cat api.py.tail >> $@


glcorearb.h:
	wget --no-verbose $(GLHEADER_URL)


clean:
	rm -f api.py

dist-clean: clean
	rm -f $(GLHEADER)


# Very simple test. Just check that the file loads without errors.
test: api.py
	$(PYTHON) api.py
